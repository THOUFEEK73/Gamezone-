<nav class="bg-white shadow-md fixed w-full top-0 z-50">
  <div class="w-full px-4 md:px-8">
    <div class="flex justify-between h-16">
      <!-- Logo -->
      <div class="flex items-center">
        <a href="/home" class="flex items-center">
          <h1 class="text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-indigo-600 to-pink-600 hover:from-indigo-500 hover:to-pink-500 transition duration-300">
            ðŸŽ® GameZone
          </h1>
        </a>
      </div>

      <!-- Desktop Nav -->
      <div class="hidden md:flex items-center space-x-8">
        <% if (page !== 'wishlist' && page !== 'cart' && page !== 'profile' && page !== 'orderDetails' && page !== 'viewOrder' && page!= 'address' &&  page !== 'gameDetail' && page !== 'orderSuccess' && page !== 'checkout' && page !== 'paymentFailed') { %>
        <!-- Search Input Field -->
        <div class="relative">
          <input type="text" placeholder="Search games..." id="searchInput"
            class="w-72 px-4 py-2 rounded-full border border-gray-200 focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 transition duration-200 bg-gray-50">
          <button class="absolute right-3 top-2.5 text-gray-400 hover:text-indigo-600">
            <i class="fas fa-search"></i>
          </button>
        </div>
        <% } %>

        <!-- Navigation Links -->
        <div class="flex items-center space-x-6">
          <a href="/allgames" class="text-gray-600 hover:text-indigo-600 font-medium <%= page === 'allgames' ? 'underline underline-offset-4 text-indigo-600' : '' %>">Store</a>
          <a id="supportBtn" href="javascript:void(0)" onclick="toggleChat()" class="relative flex items-center gap-2 text-black hover:text-indigo-400 transition duration-200">
            <i class="fas fa-headset"></i>
            <span>Support</span>
            <span id="chatNotifBadge" class="hidden absolute -top-2 -right-2 bg-red-500 text-white text-xs rounded-full px-1.5 py-0.5">0</span>
          </a>
          
          
          <a href="/wishlist"
            class="inline-flex items-center justify-center w-9 h-9 bg-red-100 text-red-500 hover:bg-red-200 hover:text-red-600 rounded-full transition duration-200 shadow <%= page === 'wishlist' ? 'ring-2 ring-red-400' : '' %>">
            <i class="fas fa-heart text-sm"></i>
          </a>
          <a href="/cart" class="relative group">
            <i class="fas fa-shopping-cart text-gray-600 hover:text-indigo-600 text-xl"></i>
            <span id="cartCounter"
              class="cart-count absolute -top-2 -right-2 bg-red-500 text-white text-xs font-bold rounded-full px-1.5 py-0.5 shadow-md transition-all duration-300">
              <%= typeof cartCount !== 'undefined' ? cartCount : 0 %>
            </span>
          </a>

          <!-- Profile Dropdown -->
          <div class="relative">
            <button id="profileDropdownBtn"
              class="flex items-center space-x-2 text-gray-600 hover:text-indigo-600 focus:outline-none">
              <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Felix" alt="Profile"
                class="w-8 h-8 rounded-full border-2 border-gray-200">
              <span class="font-medium">Profile</span>
              <i class="fas fa-chevron-down text-xs transition-transform duration-200"></i>
            </button>
            <div id="profileDropdown"
              class="absolute right-0 mt-2 w-52 bg-white rounded-xl shadow-xl py-2 opacity-0 invisible transition-all duration-200 z-50">
              <a href="/profile"
                class="flex items-center gap-2 px-4 py-2 text-gray-700 hover:bg-indigo-100 hover:text-indigo-700 transition rounded-md">
                <i class="fas fa-user text-base"></i>
                <span class="text-sm font-medium">My Profile</span>
              </a>
              <a href="/orderDetails"
                class="flex items-center gap-2 px-4 py-2 text-gray-700 hover:bg-indigo-100 hover:text-indigo-700 transition rounded-md">
                <i class="fas fa-shopping-bag text-base"></i>
                <span class="text-sm font-medium">Orders</span>
              </a>
              <a href="/wishlist"
                class="flex items-center gap-2 px-4 py-2 text-red-600 hover:bg-red-100 hover:text-red-700 transition rounded-md">
                <i class="fas fa-heart text-base"></i>
                <span class="text-sm font-medium">Wishlist</span>
              </a>
              <hr class="my-2 border-gray-200">
              <a href="/logout"
                class="flex items-center gap-2 px-4 py-2 text-red-600 hover:bg-red-100 hover:text-red-700 transition rounded-md">
                <i class="fas fa-sign-out-alt text-base"></i>
                <span class="text-sm font-medium">Logout</span>
              </a>
            </div>
          </div>
        </div>
      </div>

      <!-- Mobile Button -->
      <div class="flex items-center md:hidden">
        <button id="mobileMenuBtn" class="text-gray-600 hover:text-indigo-600 focus:outline-none">
          <i class="fas fa-bars text-2xl"></i>
        </button>
      </div>
    </div>
  </div>

  <!-- Mobile Nav -->
  <div id="mobileMenu" class="hidden md:hidden bg-white border-t border-gray-100">
    <div class="px-4 py-3 space-y-2">
      <% if (page !== 'wishlist' && page !== 'cart' && page !== 'profile' && page !== 'orderDetails' && page !== 'viewOrder' && page !== 'gameDetail' && page !== 'orderSuccess' && page !== 'checkout' && page !== 'paymentFailed') { %>
      <div class="relative mb-2">
        <input type="text" placeholder="Search games..." id="searchInputMobile"
          class="w-full px-4 py-2 rounded-full border border-gray-200 focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 transition duration-200 bg-gray-50">
        <button class="absolute right-3 top-2.5 text-gray-400 hover:text-indigo-600">
          <i class="fas fa-search"></i>
        </button>
      </div>
      <% } %>
      <a href="/allgames" class="block py-2 text-gray-600 hover:text-indigo-600 font-medium <%= page === 'allgames' ? 'font-bold text-indigo-600' : '' %>">Store</a>
     
      <a href="/wishlist" class="block py-2 text-gray-600 hover:text-indigo-600 font-medium <%= page === 'wishlist' ? 'font-bold text-indigo-600' : '' %>">Wishlist</a>
      <a href="/cart" class="block py-2 text-gray-600 hover:text-indigo-600 font-medium <%= page === 'cart' ? 'font-bold text-indigo-600' : '' %>">Cart</a>
      <a href="/profile" class="block py-2 text-gray-600 hover:text-indigo-600 font-medium <%= page === 'profile' ? 'font-bold text-indigo-600' : '' %>">Profile</a>
      <a href="/orderDetails" class="block py-2 text-gray-600 hover:text-indigo-600 font-medium <%= page === 'orderDetails' ? 'font-bold text-indigo-600' : '' %>">Orders</a>

      <hr class="my-2 border-gray-100">
      <a href="/logout" class="block py-2 text-red-600 hover:text-red-700 font-medium">Logout</a>
    </div>
  </div>


<!-- Chat Support Popup -->
<div id="chatPopup" class="fixed top-20 right-5 w-[92%] max-w-sm bg-white rounded-3xl shadow-2xl border border-gray-200 z-50 hidden transition-all duration-300 overflow-hidden">
  
  <!-- Header -->
  <div class="bg-gradient-to-br from-[#25D366] to-[#128C7E] text-white px-5 py-3 flex justify-between items-center">
    <h4 class="font-semibold text-base flex items-center gap-2">
      <i class="fas fa-comment-dots text-white animate-bounce"></i>
      Chat with Us
    </h4>
    <button onclick="toggleChat()" class="text-white text-xl hover:scale-110 transition">&times;</button>
  </div>

  <!-- Chat Body -->
  <div id="chatMessages" class="p-4 h-[400px] overflow-y-auto flex flex-col gap-3 bg-gradient-to-br from-gray-50 to-white scroll-smooth">
    <div class="self-start bg-white text-gray-800 px-4 py-2 rounded-2xl shadow-sm max-w-[80%] border border-gray-200">
      ðŸ‘‹ Hello! How can we assist you today?
    </div>
  </div>

  <!-- Chat Input -->
  <form onsubmit="sendMessage(event)" class="flex border-t border-gray-200 bg-white p-3 gap-2">
    <input
      type="text"
      id="chatInput"
      placeholder="Type your message..."
      autocomplete="off"
      class="flex-1 px-4 py-2 rounded-full bg-gray-100 text-sm focus:outline-none focus:ring-2 focus:ring-[#25D366] transition"
      required
    />
    <button
      type="submit"
      class="bg-[#25D366] hover:bg-[#1EBE58] text-white px-5 py-2 rounded-full text-sm font-medium shadow-sm transition"
    >
      Send
    </button>
  </form>
</div>



<script src="/socket.io/socket.io.js"></script>
  <script>
    // Mobile menu toggle
    const mobileMenuBtn = document.getElementById('mobileMenuBtn');
    const mobileMenu = document.getElementById('mobileMenu');
    mobileMenuBtn.addEventListener('click', () => {
      mobileMenu.classList.toggle('hidden');
    });

    // Profile dropdown toggle
    const profileBtn = document.getElementById('profileDropdownBtn');
    const profileMenu = document.getElementById('profileDropdown');
    profileBtn.addEventListener('click', (e) => {
      e.stopPropagation();
      profileMenu.classList.toggle('invisible');
      profileMenu.classList.toggle('opacity-0');
      profileMenu.classList.toggle('opacity-100');
      profileMenu.classList.toggle('visible');
    });
    document.addEventListener('click', (e) => {
      if (!profileMenu.contains(e.target) && !profileBtn.contains(e.target)) {
        profileMenu.classList.add('invisible');
        profileMenu.classList.add('opacity-0');
        profileMenu.classList.remove('opacity-100');
        profileMenu.classList.remove('visible');
      }
    });

 
    const socket = io();

  // Get user info from EJS
  const userId = "<%= user && user._id ? user._id : '' %>" || localStorage.getItem('guestId') || (() => {
  const id = 'guest-' + Math.random().toString(36).substr(2, 9);
  localStorage.setItem('guestId', id);
  return id;
})();
const userName = "<%= user && user.name ? user.name : 'Guest' %>";

  console.log("âœ… From navbar: Guest",userId);

  // Join user room as guest
  socket.emit('join', userId);

  // Notify server when user is online as guest
  socket.emit('userOnline', { userId });

  // Notify server when user disconnects or refreshes as guest
  window.addEventListener('beforeunload', () => {
    socket.emit('userOffline', { userId, userName });
  });

  // Typing status
  const chatInput = document.getElementById('chatInput');
  if (chatInput) {
    chatInput.addEventListener('input', () => {
      socket.emit('userTyping', { userId, userName });
    });
  }

  // Send user message
  function sendMessage(event) {
    event.preventDefault();
    const input = document.getElementById('chatInput');
    const messages = document.getElementById('chatMessages');

    if (!input || !messages) return;

    const text = input.value.trim();
    if (text !== '') {
      // Show user message
      const msgDiv = document.createElement('div');
      msgDiv.className = 'self-end bg-indigo-100 text-gray-800 px-3 py-2 rounded-lg shadow';
      msgDiv.textContent = text;
      messages.appendChild(msgDiv);
      messages.scrollTop = messages.scrollHeight;

      // Emit message to server as guest
      socket.emit('userMessage', {
        userId,
        userName,
        message: text,
        sender: 'user',
        timestamp: new Date()
      });

      input.value = '';
    }
  }



  // Listen for admin reply
socket.on('newMessage', (msg) => {
  if (msg.sender === 'admin') {
    console.log("Admin reply received:", msg);
    const messages = document.getElementById('chatMessages');
    const replyDiv = document.createElement('div');
    replyDiv.className = 'self-start bg-gray-100 text-gray-700 px-3 py-2 rounded-lg shadow';
    replyDiv.textContent = msg.message;
    messages.appendChild(replyDiv);
    messages.scrollTop = messages.scrollHeight;

    // Show notification badge if chat popup is hidden
    const chatPopup = document.getElementById('chatPopup');
    const chatNotifBadge = document.getElementById('chatNotifBadge');
    if (chatPopup && chatNotifBadge && chatPopup.classList.contains('hidden')) {
  // Get current count or default to 0
  let count = parseInt(chatNotifBadge.textContent) || 0;
  count += 1;
  chatNotifBadge.textContent = count;
  chatNotifBadge.classList.remove('hidden');
  showChatToast('New message from support!');
  const audio = new Audio('https://notificationsounds.com/storage/sounds/file-sounds-1151-pristine.mp3');
audio.play().catch((err) => {
  console.warn('Audio play failed:', err);
});


}
  }
});

// Hide badge when chat is opened
function toggleChat() {
  const popup = document.getElementById('chatPopup');
  const chatNotifBadge = document.getElementById('chatNotifBadge');
  if (popup) {
    popup.classList.toggle('hidden');
    // Hide notification badge when chat is opened
    if (!popup.classList.contains('hidden') && chatNotifBadge) {
      chatNotifBadge.classList.add('hidden');
    }
  }
}



function showChatToast(message) {
  const toast = document.createElement('div');

  toast.className = `
    fixed left-1/2 transform -translate-x-1/2 
    bg-white text-gray-800 px-4 py-3 rounded-2xl shadow-lg 
    border border-gray-300 z-50 flex items-center space-x-3 
    animate-toast-slide-down w-[340px] max-w-[90%]
  `;
  toast.style.top = '70px';

  toast.innerHTML = `
  <div class="w-10 h-10 flex items-center justify-center bg-green-500 text-white rounded-full text-lg font-semibold">
    ðŸ’¬
  </div>
  <div class="flex-1">
    <p class="text-sm font-semibold text-green-600">Support Team</p>
    <p class="text-xs text-gray-700">${message}</p>
  </div>
`;


  // Add animation styles
  const style = document.createElement('style');
  style.textContent = `
    @keyframes toastSlideDown {
      from {
        opacity: 0;
        transform: translate(-50%, -40px);
      }
      to {
        opacity: 1;
        transform: translate(-50%, 0);
      }
    }

    .animate-toast-slide-down {
      animation: toastSlideDown 0.4s ease-out;
    }
  `;
  document.head.appendChild(style);

  document.body.appendChild(toast);

  setTimeout(() => toast.remove(), 4000);
}


  </script>


</nav>
<!-- This padding ensures content is never overlapped by the fixed navbar -->
<div class="pt-20 md:pt-10"></div>