<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Manage Users - GameZone Admin</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
        rel="stylesheet" />
    <style>
        :root {
            --primary-bg: #f8fafc;
            --secondary-bg: #ffffff;
            --accent-color: #4f46e5;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --border-color: #e2e8f0;
            --card-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1),
                0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        body {
            background-color: var(--primary-bg);
            color: var(--text-primary);
            min-height: 100vh;
            transition: all 0.3s ease;
            font-family: "Inter", sans-serif;
        }

        .sidebar {
            background-color: var(--secondary-bg);
            border-right: 1px solid var(--border-color);
            position: fixed;
            left: 0;
            top: 0;
            height: 100vh;
            width: 280px;
            overflow-y: auto;
            z-index: 50;
            transition: all 0.3s ease;
        }

        .card {
            background-color: var(--secondary-bg);
            border-radius: 1rem;
            box-shadow: var(--card-shadow);
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
        }

        .card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1),
                0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }

        .nav-group {
            position: relative;
        }

        .nav-group-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
            padding: 0.75rem 1rem;
            border-radius: 0.75rem;
            transition: all 0.2s ease;
        }

        .nav-group-header:hover {
            background: rgba(79, 70, 229, 0.1);
        }

        .nav-group-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }

        .nav-group-content.show {
            max-height: 500px;
        }

        .nav-group-toggle {
            transition: transform 0.3s ease;
        }

        .nav-group-toggle.rotated {
            transform: rotate(180deg);
        }

        .nav-link {
            display: flex;
            align-items: center;
            padding: 0.75rem 1rem;
            color: var(--text-secondary);
            border-radius: 0.75rem;
            transition: all 0.2s ease;
            margin-bottom: 0.25rem;
        }

        .nav-link:hover {
            background: rgba(79, 70, 229, 0.1);
            color: var(--accent-color);
            transform: translateX(4px);
        }

        .nav-link.active {
            background: rgba(79, 70, 229, 0.2);
            color: var(--accent-color);
        }

        .nav-link i {
            width: 20px;
            margin-right: 0.75rem;
            text-align: center;
        }

        .sidebar-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 1rem;
        }

        .sidebar-logo {
            display: flex;
            align-items: center;
            margin-bottom: 1rem;
        }

        .sidebar-logo i {
            font-size: 1.75rem;
            color: var(--accent-color);
            margin-right: 0.75rem;
        }

        .sidebar-logo h1 {
            font-size: 1.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, #4f46e5, #7c3aed);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .sidebar-footer {
            padding: 1.5rem;
            border-top: 1px solid var(--border-color);
            margin-top: auto;
        }

        .user-profile {
            display: flex;
            align-items: center;
            padding: 0.75rem;
            border-radius: 0.75rem;
            background: rgba(79, 70, 229, 0.1);
            transition: all 0.2s ease;
        }

        .user-profile:hover {
            background: rgba(79, 70, 229, 0.2);
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-right: 0.75rem;
            border: 2px solid var(--accent-color);
        }

        .user-info {
            flex: 1;
        }

        .user-name {
            font-size: 0.875rem;
            font-weight: 600;
        }

        .user-role {
            font-size: 0.75rem;
        }

        .table-header {
            font-size: 0.75rem;
            font-weight: 600;
        }

        .table-data {
            font-size: 0.875rem;
        }

        .status-badge {
            font-size: 0.75rem;
        }

        .search-input {
            font-size: 0.875rem;
        }

        .action-button {
            font-size: 0.8125rem;
        }
    </style>
</head>

<body class="flex h-screen">
    <!-- Include the sidebar partial -->
    <%- include('./partials/sidebar', { currentPage: 'users-list' }) %>

        <!-- Mobile Sidebar Toggle -->
        <button class="sidebar-toggle lg:hidden">
            <i class="fas fa-bars text-gray-600"></i>
        </button>

        <!-- Main Content -->
        <div class="flex-1 ml-72 p-8 main-content">
            <!-- Header -->
            <div class="flex justify-between items-center mb-8">
                <div>
                    <h1 class="text-3xl font-bold text-gray-800">Manage Users</h1>
                    <p class="text-gray-600 mt-2">View and manage all user accounts</p>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="relative">
                        <button class="p-3 rounded-xl bg-white shadow-lg hover:shadow-xl transition-all duration-300">
                            <i class="fas fa-bell text-gray-600 text-lg"></i>
                        </button>
                        <span
                            class="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center font-bold">3</span>
                    </div>
                    <div class="relative">
                        <button
                            class="flex items-center space-x-3 p-3 rounded-xl bg-white shadow-lg hover:shadow-xl transition-all duration-300">
                            <img src="/images/default-avatar.png" alt="Admin"
                                class="w-8 h-8 rounded-full border-2 border-indigo-500" />
                            <span class="text-sm font-medium text-gray-700">Admin</span>
                            <i class="fas fa-chevron-down text-sm text-gray-500"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Search and Filter -->
            <div class="flex justify-between items-center mb-6">
                <div class="relative w-64">
                    <input type="text" placeholder="Search users..."
                        class="search-input w-full pl-10 pr-4 py-2.5 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent" />
                    <i class="fas fa-search absolute left-3 top-3.5 text-gray-400"></i>
                </div>
                <div class="flex space-x-2">
                    <button
                        class="px-4 py-2 rounded-xl bg-indigo-50 text-indigo-600 hover:bg-indigo-100 transition-all duration-300">
                        <i class="fas fa-filter mr-2"></i>
                        Filter
                    </button>
                    <button
                        class="px-4 py-2 rounded-xl bg-indigo-50 text-indigo-600 hover:bg-indigo-100 transition-all duration-300">
                        <i class="fas fa-download mr-2"></i>
                        Export
                    </button>
                </div>
            </div>

            <!-- Users Table -->
            <div class="card overflow-hidden table-responsive">
                <table class="min-w-full divide-y divide-gray-100">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                User
                            </th>
                            <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                Email
                            </th>
                            <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                Joined Date
                            </th>
                            <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                Status
                            </th>
                            <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                Actions
                            </th>
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-100">
                        <% users.forEach(function(user) { %>
                            <tr class="table-row-hover">
                                <td class="px-6 py-5 whitespace-nowrap">
                                    <div class="flex items-center">
                                        <div class="ml-4">
                                            <div class="text-sm font-semibold text-gray-900">
                                                <%= user.designation || "User" %>
                                            </div>
                                            <div class="text-sm text-gray-500">
                                                <%= user.name %>
                                            </div>
                                        </div>
                                    </div>
                                </td>

                                <td class="px-6 py-5 whitespace-nowrap">
                                    <div class="text-sm text-gray-900">
                                        <%= user.email %>
                                    </div>
                                </td>

                                <td class="px-6 py-5 whitespace-nowrap">
                                    <div class="text-sm text-gray-900">
                                        <%= user.joinedDate || "N/A" %>
                                    </div>
                                </td>

                                <td class="px-6 py-5 whitespace-nowrap">
                                    <div class="inline-flex items-center gap-2 text-sm font-medium">
                                        <% if (user.isVerified === true) { %>
                                            <span class="flex items-center text-green-600">
                                                <i class="fas fa-check-circle text-base mr-1.5"></i>
                                                Verified
                                            </span>
                                        <% } else { %>
                                            <span class="flex items-center text-red-600">
                                                <i class="fas fa-ban text-base mr-1.5"></i>
                                                Blocked
                                            </span>
                                        <% } %>
                                    </div>
                                </td>

                                <!-- Block/Unblock Button -->
                                <td class="px-6 py-5 whitespace-nowrap">
                                    <% if (user.isVerified == true) { %>
                                      <!-- Block Button (Modern Lock Icon) -->
                                      <button
                                        class="p-1.5 text-red-600 bg-red-100 bg-opacity-40 rounded-md hover:bg-red-200 hover:bg-opacity-60 transition-all duration-200 flex items-center justify-center"
                                        onclick="toggleUserBlock('<%= user._id %>', false)"
                                        title="Block User"
                                      >
                                        <i class="fas fa-user-lock"></i>
                                      </button>
                                    <% } else { %>
                                      <!-- Unblock Button (Modern Unlock Icon) -->
                                      <button
                                        class="p-1.5 text-green-600 bg-green-100 bg-opacity-40 rounded-md hover:bg-green-200 hover:bg-opacity-60 transition-all duration-200 flex items-center justify-center"
                                        onclick="toggleUserBlock('<%= user._id %>', true)"
                                        title="Unblock User"
                                      >
                                        <i class="fas fa-user-check"></i>
                                      </button>
                                    <% } %>
                                  </td>
                            </tr>
                            <% }) %>
                    </tbody>
                </table>
            </div>
        </div>

        <script>
            // Toggle user block/unblock status
            function toggleUserBlock(userId, isVerified) {
              fetch('/admin/users/toggle-status', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ userId, isVerified })
              })
              .then(res => res.json())
              .then(data => {
                if (data.success) {
                  window.location.reload(); // refresh to see changes
                } else {
                  alert('Failed to update user status.');
                }
              })
              .catch(err => console.error(err));
            }

            // Sidebar Navigation Groups
            document.querySelectorAll(".nav-group-header").forEach((header) => {
                header.addEventListener("click", () => {
                    const content = header.nextElementSibling;
                    const toggle = header.querySelector(".nav-group-toggle");

                    content.classList.toggle("show");
                    toggle.classList.toggle("rotated");
                });
            });

            // Mobile Sidebar Toggle
            const sidebarToggle = document.querySelector(".sidebar-toggle");
            const sidebar = document.querySelector(".sidebar");

            sidebarToggle.addEventListener("click", () => {
                sidebar.classList.toggle("show");
            });

            // Close sidebar when clicking outside on mobile
            document.addEventListener("click", (e) => {
                if (window.innerWidth <= 768) {
                    if (
                        !sidebar.contains(e.target) &&
                        !sidebarToggle.contains(e.target)
                    ) {
                        sidebar.classList.remove("show");
                    }
                }
            });
        </script>
</body>

</html>